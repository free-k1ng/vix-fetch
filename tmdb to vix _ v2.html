<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>TMDB → VixSrc Link Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; padding: 12px; background: #f5f5f5; }
    h2 { margin-top: 0; }
    label { display: block; margin-top: 10px; }
    input, select, button { width: 100%; padding: 8px; margin-top: 4px; font-size: 16px; }
    button { margin-top: 14px; }
    .result { margin-top: 16px; padding: 10px; background: #fff; word-wrap: break-word; }
    .error { color: #b00020; }
    .small { font-size: 12px; color: #555; }
  </style>
</head>
<body>

<h2>TMDB → VixSrc Link Generator</h2>

<label>
  Type
  <select id="type">
    <option value="movie">Movie</option>
    <option value="tv">TV Show</option>
  </select>
</label>

<label>
  Movie / Show Name
  <input type="text" id="title" placeholder="e.g. The Matrix or Breaking Bad">
</label>

<label id="seasonLabel">
  Season Number
  <input type="number" id="season" min="1" placeholder="e.g. 1">
</label>

<label id="episodeLabel">
  Episode Number
  <input type="number" id="episode" min="1" placeholder="e.g. 1">
</label>

<button type="button" onclick="generateLink()">Generate VixSrc Link</button>

<div id="output" class="result"></div>

<script type="text/javascript">
// TMDB API key (v3 query parameter for maximum compatibility)
var TMDB_API_KEY = "e0f8c3121386db3c0c8a93f2da63804f";

var typeSelect = document.getElementById('type');
var seasonLabel = document.getElementById('seasonLabel');
var episodeLabel = document.getElementById('episodeLabel');

function updateVisibility() {
  if (typeSelect.value === 'tv') {
    seasonLabel.style.display = 'block';
    episodeLabel.style.display = 'block';
  } else {
    seasonLabel.style.display = 'none';
    episodeLabel.style.display = 'none';
  }
}

// iOS Safari sometimes fails onchange unless explicitly bound
if (typeSelect.addEventListener) {
  typeSelect.addEventListener('change', updateVisibility, false);
} else {
  typeSelect.onchange = updateVisibility;
}

// Ensure correct state on page load (important for iOS Safari)
updateVisibility();

function generateLink() {
  var title = document.getElementById('title').value;
  var type = typeSelect.value;
  var season = document.getElementById('season').value;
  var episode = document.getElementById('episode').value;
  var output = document.getElementById('output');

  output.innerHTML = '';

  if (!title) {
    output.innerHTML = '<span class="error">Please enter a movie or show name.</span>';
    return;
  }

  if (type === 'tv' && (!season || !episode)) {
    output.innerHTML = '<span class="error">Season and episode numbers are required for TV shows.</span>';
    return;
  }

  var endpoint = (type === 'movie') ? 'search/movie' : 'search/tv';
  var url = 'https://api.themoviedb.org/3/' + endpoint +
            '?api_key=' + TMDB_API_KEY +
            '&query=' + encodeURIComponent(title);

  var xhr = new XMLHttpRequest();
  xhr.open('GET', url, true);
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        var data;
        try {
          data = JSON.parse(xhr.responseText);
        } catch (e) {
          output.innerHTML = '<span class="error">Invalid TMDB response.</span>';
          return;
        }

        if (!data.results || data.results.length === 0) {
          output.innerHTML = '<span class="error">No results found on TMDB.</span>';
          return;
        }

        var tmdbId = data.results[0].id;
        var link;

        if (type === 'movie') {
          link = 'https://vixsrc.to/movie/' + tmdbId;
        } else {
          link = 'https://vixsrc.to/tv/' + tmdbId + '/' + season + '/' + episode;
        }

        output.innerHTML =
          '<strong>TMDB ID:</strong> ' + tmdbId + '<br><br>' +
          '<strong>VixSrc Link:</strong><br>' +
          '<a href="' + link + '" target="_blank">' + link + '</a>' +
          '<div class="small">Uses first TMDB search result</div>';
      } else {
        output.innerHTML = '<span class="error">TMDB request failed (HTTP ' + xhr.status + ').</span>';
      }
    }
  };

  xhr.send(null);
}
</script>

</body>
</html>